Function DownloadFileFromPage(e) ' [KEYWORD=TRUE] '@L4	Dim curPage	Err.Clear: On Error GoTo 0	On Error Resume Next	Set s = Evaluate(e)	If s("run") = 1 Then		Set stepReference = s("obj")		stepData = e("data_in") 		If userEnvironment("Automation_DefaultBrowser") = "iexplore.exe" Or userEnvironment("Automation_DefaultBrowser") = "" Then			If Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save").Exist(30) Then				HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "WAIT[2]", "N"				SendKey Dialog("index:=0","nativeclass:=#32770").WinEdit("attached text:=File name:","index:=0"), stepData, "", "WAIT[2]", "N"				HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "WAIT[2]", "N"				HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=Close","index:=0"), "", "", "EXIST[2]", "N"			Else				If Browser("CreationTime:=1").WinObject("text:=AVPageView","index:=0").Exist(10) Then					Set curPage = Browser("CreationTime:=1").WinObject("text:=AVPageView","index:=0")				ElseIf Window("nativeclass:=AcrobatSDIWindow").WinObject("text:=AVPageView","index:=0").Exist(10) Then					Set curPage = Window("nativeclass:=AcrobatSDIWindow").WinObject("text:=AVPageView","index:=0")				Else					Set curPage = Browser("CreationTime:=1").Page("index:=0")				End If				If curPage.Exist(10) Then					curPage.highlight					If Err.Number = 0 Then						Wait 1						Set wShell = CreateObject("WScript.Shell")						wShell.SendKeys "%f"						Wait 1						wShell.SendKeys "a"						If Not Dialog("index:=0","nativeclass:=#32770").Exist(2) Then							curPage.highlight							Wait 1							Set wShell = CreateObject("WScript.Shell")							wShell.SendKeys "%"							Wait 5							wShell.SendKeys "f"							Wait 3							wShell.SendKeys "a"						End If						SendKey Dialog("index:=0","nativeclass:=#32770").WinEdit("attached text:=File name:","index:=0"), stepData, "", "WAIT[2]", "N"						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "WAIT[2]", "N"						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "EXIST[1]", "N"						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=Close","index:=0"), "", "", "EXIST[5]", "N"						If CInt(myPactera_commonFunction_getActiveBrowserIndex) >= 1 Then 							Browser("CreationTime:=" & myPactera_commonFunction_getActiveBrowserIndex).Highlight							Browser("CreationTime:=" & myPactera_commonFunction_getActiveBrowserIndex).Close						End If						If Window("nativeclass:=AcrobatSDIWindow").Exist(3) Then Window("nativeclass:=AcrobatSDIWindow").Close					End If					Err.Clear: On Error GoTo 0				End If			End If		ElseIf userEnvironment("Automation_DefaultBrowser") = "chrome.exe" Then			If Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save").Exist(30) Then				SendKey Dialog("index:=0","nativeclass:=#32770").WinEdit("attached text:=File name:","index:=0"), stepData, "", "WAIT[2]", "N"				HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "WAIT[2]", "N"				Wait(5)				HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=Close","index:=0"), "", "", "EXIST[2]", "N"			Else				If Browser("CreationTime:=1").WinObject("text:=AVPageView","index:=0").Exist(10) Then					Set curPage = Browser("CreationTime:=1").WinObject("text:=AVPageView","index:=0")				ElseIf Window("nativeclass:=AcrobatSDIWindow").WinObject("text:=AVPageView","index:=0").Exist(10) Then					Set curPage = Window("nativeclass:=AcrobatSDIWindow").WinObject("text:=AVPageView","index:=0")				Else					Set curPage = Browser("CreationTime:=1").Page("index:=0")				End If				If curPage.Exist(10) Then					curPage.highlight					If Err.Number = 0 Then						Wait 1						Set wShell = CreateObject("WScript.Shell")						wShell.SendKeys "%f"						Wait 1						wShell.SendKeys "a"						If Not Dialog("index:=0","nativeclass:=#32770").Exist(2) Then							curPage.highlight							Wait 1							Set wShell = CreateObject("WScript.Shell")							wShell.SendKeys "%"							Wait 5							wShell.SendKeys "f"							Wait 3							wShell.SendKeys "a"						End If						SendKey Dialog("index:=0","nativeclass:=#32770").WinEdit("attached text:=File name:","index:=0"), stepData, "", "WAIT[2]", "N"						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "WAIT[2]", "N"						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "EXIST[1]", "N"						Wait(5)						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=Close","index:=0"), "", "", "EXIST[5]", "N"						If CInt(myPactera_commonFunction_getActiveBrowserIndex) >= 1 Then 							Browser("CreationTime:=" & myPactera_commonFunction_getActiveBrowserIndex).Highlight							Browser("CreationTime:=" & myPactera_commonFunction_getActiveBrowserIndex).Close						End If						If Window("nativeclass:=AcrobatSDIWindow").Exist(3) Then Window("nativeclass:=AcrobatSDIWindow").Close					End If					Err.Clear: On Error GoTo 0				End If			End If		ElseIf userEnvironment("Automation_DefaultBrowser") = "firefox.exe" Then			If  Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=MozillaDialogClass").Page("index:=0").WebButton("name:=OK","index:=0").Exist(10) Then				If Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=MozillaDialogClass").Page("index:=0").WebElement("innertext:=Save File","index:=0").Exist(5) Then					Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=MozillaDialogClass").Page("index:=0").WebElement("innertext:=Save File","index:=0").Highlight					Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=MozillaDialogClass").Page("index:=0").WebElement("innertext:=Save File","index:=0").Click				End If				Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=MozillaDialogClass").Page("index:=0").WebButton("name:=OK","index:=0").Highlight				Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=MozillaDialogClass").Page("index:=0").WebButton("name:=OK","index:=0").Click				SendKey Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=#32770").WinEdit("attached text:=File name:","index:=0"), stepData, "", "WAIT[2]", "N"				HighlightClick Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "WAIT[2]", "N"				HighlightClick Browser("CreationTime:=0").Dialog("index:=0","nativeclass:=#32770").Dialog("index:=0").WinButton("text:=&Yes"), "", "", "WAIT[2],EXIST[2]", "N"				Wait(5)			Else				If Browser("CreationTime:=1").WinObject("text:=AVPageView","index:=0").Exist(10) Then					Set curPage = Browser("CreationTime:=1").WinObject("text:=AVPageView","index:=0")				ElseIf Window("nativeclass:=AcrobatSDIWindow").WinObject("text:=AVPageView","index:=0").Exist(10) Then					Set curPage = Window("nativeclass:=AcrobatSDIWindow").WinObject("text:=AVPageView","index:=0")				Else					Set curPage = Browser("CreationTime:=1").Page("index:=0")				End If				If curPage.Exist(10) Then					curPage.highlight					If Err.Number = 0 Then						Wait 1						Set wShell = CreateObject("WScript.Shell")						wShell.SendKeys "%f"						Wait 1						wShell.SendKeys "a"						If Not Dialog("index:=0","nativeclass:=#32770").Exist(2) Then							curPage.highlight							Wait 1							Set wShell = CreateObject("WScript.Shell")							wShell.SendKeys "%"							Wait 5							wShell.SendKeys "f"							Wait 3							wShell.SendKeys "a"						End If						SendKey Dialog("index:=0","nativeclass:=#32770").WinEdit("attached text:=File name:","index:=0"), stepData, "", "WAIT[2]", "N"						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "WAIT[2]", "N"						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=&Save"), "", "", "EXIST[1]", "N"						Wait(5)						HighlightClick Dialog("index:=0","nativeclass:=#32770").WinButton("text:=Close","index:=0"), "", "", "EXIST[5]", "N"						If CInt(myPactera_commonFunction_getActiveBrowserIndex) >= 1 Then 							Browser("CreationTime:=" & myPactera_commonFunction_getActiveBrowserIndex).Highlight							Browser("CreationTime:=" & myPactera_commonFunction_getActiveBrowserIndex).Close						End If						If Window("nativeclass:=AcrobatSDIWindow").Exist(3) Then Window("nativeclass:=AcrobatSDIWindow").Close					End If					Err.Clear: On Error GoTo 0				End If			End If		End If	End If	COMMON_GLOBAL_VARIABLE_01 = stepData	omnilite_update_data	stepData, e("data_out")	Set DownloadFileFromPage = EvaluateExecution(Err, "")	Err.Clear: On Error GoTo 0End Function